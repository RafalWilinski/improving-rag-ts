{cells:[{kind:2,language:'typescriptreact',value:'import { generateObject, embed } from "ai";\nimport { openai } from "@ai-sdk/openai";\nimport { jsonView, json } from "@githubnext/vitale";\nimport { z } from "zod";\n\nconst productsCount = 5;\nconst { object } = await generateObject({\n  model: openai("gpt-4o-mini"),\n  prompt: `Create a list of ${productsCount} products someone might buy at a hardware store Each product title should be repeated 2-3 times. Do not have any with duplicate product descriptions.\n  \nSo each product with a given title should have some small distinctions apparent from the description.\\nProducts can be small (a screw), large (a bandsaw) or anywhere in between.\n\nFor each product, write a 2-3 sentence product description that might show up in a hardware retailers website underneath the product Do not create product reviews that contradict specific facts in other reviews. Contradicting subjective opinions in other reviews is ok only to the extent you would expect that in real data.Respond only with the list of products and descriptions.`,\n  schema: z.object({\n    products: z.array(z.object({\n      title: z.string(),\n      description: z.string(),\n    }))\n  })\n});\n\nconst products = object.products\njsonView(products[0]);\n',metadata:{id:'mVdIe-iBP4FhhwvGSmU69'}},{kind:2,language:'typescriptreact',value:'async function makeReviews(product: { title: string; description: string }, reviewsCount: number) {\n  const { title, description } = product;\n  const { object } = await generateObject({\n    model: openai("gpt-4o-mini"),\n    prompt: `Write ${reviewsCount} realistic but detailed/specific product reviews that might show up on a hardware store\'s website. The reviews should be about the following product:\n  \nProduct Title: ${title}\nProduct Description: ${description}\n\nAdd many relevant and concrete facts about the products (this is for synthetic data generation, make up facts about each product as necessary). To see the format of a possible review, here is a review for a saw:\n\n"""\nI\'ve enjoyed using this saw. It is lightweight and the battery lasts longer than other brands. I\'ve been using it for 3 years now and it has been very durable. It was twice as expensive as the PX-500. But it is comfortable to hold because of the light weight.\n"""\n\nRespond only with the reviews, and nothing else.`,\n    schema: z.object({\n      reviews: z.array(z.string()),\n    }),\n  });\n\n  return {\n    ...product,\n    reviews: object.reviews,\n  }\n}\n\nmakeReviews(products[0], 3);',metadata:{id:'wi1Wbt1BgahhrNxn8dcRZ'}},{kind:2,language:'typescriptreact',value:"import pLimit from 'p-limit';\n\nasync function createReviewsDataset(products: Array<{ title: string; description: string }>, reviewsPerProduct: number = 3) {\n  const limit = pLimit(5); // Set concurrency to 5\n  \n  const productsWithReviews = await Promise.all(\n    products.map(product => \n      limit(() => makeReviews(product, reviewsPerProduct))\n    )\n  );\n\n  return productsWithReviews;\n}\n\nconst reviewsDataset = await createReviewsDataset(products);\nreviewsDataset\n",metadata:{id:'w4Qxfsoa3jpvQHcXAVBkV'}},{kind:2,language:'typescriptreact',value:'import { jsonView } from "@githubnext/vitale";\njsonView(products)',metadata:{id:'ISEx2-mmXs-2_IYv2evLg'}},{kind:2,language:'typescriptreact',value:'import * as lancedb from "@lancedb/lancedb";\nimport { LanceSchema, getRegistry } from "@lancedb/lancedb/embedding";\nimport { Utf8 } from "apache-arrow";\nimport { openai } from \'@ai-sdk/openai\';\nimport { embed } from "ai";\nimport { writeFileSync } from \'fs\';\n\nconst db = await lancedb.connect("./data/lancedb");\n\nconst func = getRegistry()\n  .get("openai")\n  ?.create({ model: "text-embedding-3-small" });\n\nconst productsSchema = LanceSchema({\n  id: func.sourceField(new Utf8()),\n  title: func.sourceField(new Utf8()),\n  description: func.sourceField(new Utf8()),\n  vector: func.vectorField(),\n});\nconst reviewsSchema = LanceSchema({\n  id: func.sourceField(new Utf8()),\n  productTitle: func.sourceField(new Utf8()),\n  productDescription: func.sourceField(new Utf8()),\n  review: func.sourceField(new Utf8()),\n  vector: func.vectorField(),\n});\n\n  const reviewsTable = await db.createEmptyTable("reviews", reviewsSchema, {\n    mode: "overwrite",\n  });\n  const productsTable = await db.createEmptyTable("products", productsSchema, {\n    mode: "overwrite",\n  });\n\nawait productsTable.add(products.map((product, index) => ({\n  id: index.toString(),\n  title: product.title,\n  description: product.description,\n})));\nawait reviewsTable.add(reviewsDataset.map((review, index) => ({\n  id: index.toString(),\n  productTitle: review.title,\n  productDescription: review.description,\n  review: review.reviews,\n})));\n\ntry {\n  productsTable.createIndex("description", { replace: true });\n} catch (error) {\n  json(error);\n}\n\nconst searchVector = await embed({\n  model: openai.embedding("text-embedding-3-small"),\n  value: "Cordless saw",\n});\nconst results = await productsTable.vectorSearch(searchVector.embedding).limit(20).toArray();\n\nwriteFileSync(\'./reviews.json\', JSON.stringify(reviewsDataset, null, 2));\njsonView(results)\n',metadata:{id:'z-pmML_OewpBLdna2dQk4'}},{kind:2,language:'typescriptreact',value:'',metadata:{id:'THAdKq4AooQQSdSSG9IBc'}}]}